min_version = "2025.11.3"
experimental_monorepo_root = true

[settings]
experimental = true

[env]
CARGO_HOME = "{{env.HOME}}/.cargo"
RUSTUP_HOME = "{{env.HOME}}/.rustup"
PYO3_USE_ABI3_FORWARD_COMPATIBILITY = "1"
UV_LINK_MODE = "copy"
BASELINE_BROWSER_MAPPING_IGNORE_OLD_DATA = "true"
BROWSERSLIST_IGNORE_OLD_DATA = "true"

[tools]
biome = "latest"
bun = "latest"
node = "lts"
python = "latest"
rust = "latest"
uv = "latest"

[tasks.setup]
run = [
	"mise run //backend:install",
	"mise run //frontend:install",
	"mise run //ieapp-cli:install",
	"mise run //ieapp-core:install",
	"mise run //e2e:install",
]

[tasks.dev]
depends = ["//backend:dev", "//frontend:dev"]

[tasks.test]
depends = ["//backend:test", "//frontend:test", "//ieapp-cli:test", "//ieapp-core:test", "test:docs"]
description = "Run tests for all packages (ieapp-core, backend, frontend, ieapp-cli)"

[tasks."test:docs"]
description = "Check consistency between documentation and implementation"
run = "uv run --with pytest --with pyyaml pytest docs/tests -v"

[tasks.e2e]
description = "Run E2E tests with backend and frontend servers"
run = "bash scripts/run-e2e.sh full"

[tasks."e2e:smoke"]
description = "Run only smoke E2E tests (fast verification)"
run = "bash scripts/run-e2e.sh smoke"

[tasks."e2e:notes"]
description = "Run notes E2E tests"
run = "bash scripts/run-e2e.sh notes"