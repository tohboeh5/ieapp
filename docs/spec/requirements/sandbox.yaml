# Sandbox Requirements

category: Code Sandbox
prefix: REQ-SANDBOX

requirements:
  - id: REQ-SANDBOX-001
    title: JavaScript Execution
    description: |
      Execute JavaScript code within Wasm sandbox.
    related_spec:
      - stories/core.yaml#STORY-001
      - api/mcp.md#run_script
    priority: high
    status: implemented
    tests:
      pytest:
        - file: ieapp-cli/tests/test_sandbox.py
          tests:
            - test_simple_execution
        - file: backend/tests/test_sandbox.py
          tests:
            - test_simple_execution
      rust:
        - file: ieapp-core/tests/test_sandbox.rs
          tests:
            - test_sandbox_req_sandbox_001_simple_execution


  - id: REQ-SANDBOX-002
    title: API Calls via host.call
    description: |
      Call APIs from within sandbox using host.call function.
    related_spec:
      - api/mcp.md#host-interface
    priority: high
    status: implemented
    tests:
      pytest:
        - file: ieapp-cli/tests/test_sandbox.py
          tests:
            - test_host_call
        - file: backend/tests/test_sandbox.py
          tests:
            - test_host_call
      rust:
        - file: ieapp-core/tests/test_sandbox.rs
          tests:
            - test_sandbox_req_sandbox_002_host_call

  - id: REQ-SANDBOX-003
    title: Execution Error Handling
    description: |
      Properly capture and report script errors.
    related_spec:
      - api/mcp.md#error-handling
    priority: medium
    status: implemented
    tests:
      pytest:
        - file: ieapp-cli/tests/test_sandbox.py
          tests:
            - test_execution_error
        - file: backend/tests/test_sandbox.py
          tests:
            - test_execution_error
      rust:
        - file: ieapp-core/tests/test_sandbox.rs
          tests:
            - test_sandbox_req_sandbox_003_execution_error

  - id: REQ-SANDBOX-004
    title: Prevent Infinite Loops via Fuel Limits
    description: |
      Prevent infinite loops through fuel (CPU cycles) limits.
    related_spec:
      - security/sandbox.md
      - api/mcp.md#error-handling
    priority: high
    status: implemented
    tests:
      pytest:
        - file: ieapp-cli/tests/test_sandbox.py
          tests:
            - test_infinite_loop_fuel
        - file: backend/tests/test_sandbox.py
          tests:
            - test_infinite_loop_fuel
      rust:
        - file: ieapp-core/tests/test_sandbox.rs
          tests:
            - test_sandbox_req_sandbox_004_infinite_loop_fuel

  - id: REQ-SANDBOX-005
    title: Wasm Artifact Validation
    description: |
      Raise appropriate error when Wasm file is missing.
    related_spec:
      - security/sandbox.md
    priority: medium
    status: implemented
    tests:
      pytest:
        - file: ieapp-cli/tests/test_sandbox.py
          tests:
            - test_missing_wasm_raises
        - file: backend/tests/test_sandbox.py
          tests:
            - test_missing_wasm_raises
      rust:
        - file: ieapp-core/tests/test_sandbox.rs
          tests:
            - test_sandbox_req_sandbox_005_missing_wasm_raises
