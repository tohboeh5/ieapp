# REST API Requirements

category: REST API
prefix: REQ-API

requirements:
  - id: REQ-API-001
    title: Space CRUD
    description: |
      Create, retrieve, and list spaces.
    related_spec:
      - api/rest.md#spaces
    priority: high
    status: implemented
    tests:
      pytest:
        - file: backend/tests/test_api.py
          tests:
            - test_create_space
            - test_list_spaces
            - test_get_space
            - test_get_space_not_found
      vitest:
        - file: frontend/src/lib/client.test.ts
          tests:
            - spaceApi.list
            - spaceApi.create
      e2e:
        - file: e2e/smoke.test.ts
          tests:
            - GET /spaces returns list
            - GET /spaces includes default space

  - id: REQ-API-002
    title: Entry CRUD
    description: |
      Create, retrieve, update, and delete entries.
    related_spec:
      - api/rest.md#entries
    priority: high
    status: implemented
    tests:
      pytest:
        - file: backend/tests/test_api.py
          tests:
            - test_create_entry
            - test_list_entries
            - test_get_entry
            - test_update_entry
            - test_delete_entry
      vitest:
        - file: frontend/src/lib/client.test.ts
          tests:
            - entryApi.list
            - entryApi.create
            - entryApi.get
            - entryApi.update
            - entryApi.delete
      e2e:
        - file: e2e/entries.test.ts
          tests:
            - POST /spaces/default/entries creates a new entry
            - GET /spaces/default/entries returns entry list
            - PUT /spaces/default/entries/:id updates entry
            - DELETE /spaces/default/entries/:id removes entry

  - id: REQ-API-004
    title: Feature Registry Consistency
    description: |
      API feature registry entries MUST match implemented backend and frontend
      paths, files, and functions.
    related_spec:
      - features/README.md
      - features/features.yaml
    priority: high
    status: implemented
    tests:
      pytest:
        - file: docs/tests/test_features.py
          tests:
            - test_feature_paths_exist
            - test_no_undeclared_feature_modules

  - id: REQ-API-005
    title: Requirements Traceability Automation
    description: |
      Requirements MUST be defined in YAML and validated against test references
      in backend, frontend, ugoite-cli, and ugoite-core.
    related_spec:
      - requirements/README.md
      - testing/strategy.md
    priority: high
    status: implemented
    tests:
      pytest:
        - file: docs/tests/test_requirements.py
          tests:
            - test_requirement_ids_are_unique
            - test_required_fields_present
            - test_all_requirements_have_tests
            - test_all_tests_reference_valid_requirements
            - test_no_orphan_tests

  - id: REQ-API-006
    title: Saved SQL CRUD
    description: |
      The API MUST expose CRUD operations for saved SQL entries, including
      validation of SQL variable objects.
    related_spec:
      - api/rest.md#sql-saved-queries
      - features/sql.md#saved-sql-form
    priority: high
    status: implemented
    tests:
      pytest:
        - file: backend/tests/test_sql.py
          tests:
            - test_sql_req_api_006_crud
        - file: ugoite-cli/tests/test_saved_sql.py
          tests:
            - test_saved_sql_req_api_006_crud
      rust:
        - file: ugoite-core/tests/test_saved_sql.rs
          tests:
            - test_saved_sql_req_api_006_crud

  - id: REQ-API-007
    title: Saved SQL variable embedding and SQL validity
    description: |
      Saved SQL entries MUST embed each declared variable in the SQL text using
      {{variable_name}} placeholders, and the SQL must be valid Ugoite SQL after
      substituting placeholders with literal values.
    related_spec:
      - api/rest.md#sql-saved-queries
      - features/sql.md#saved-sql-form
    priority: high
    status: implemented
    tests:
      pytest:
        - file: backend/tests/test_sql.py
          tests:
            - test_sql_req_api_007_validation
        - file: ugoite-cli/tests/test_saved_sql.py
          tests:
            - test_saved_sql_req_api_007_validation
      rust:
        - file: ugoite-core/tests/test_saved_sql.rs
          tests:
            - test_saved_sql_req_api_007_validation_errors

  - id: REQ-API-008
    title: SQL session query API
    description: |
      The API MUST create SQL query sessions and provide status, count, rows,
      and stream endpoints for paged retrieval.
    related_spec:
      - api/rest.md#sql-sessions
    priority: high
    status: implemented
    tests:
      pytest:
        - file: backend/tests/test_api.py
          tests:
            - test_query_entries_sql
      rust:
        - file: ugoite-core/tests/test_sql_sessions.rs
          tests:
            - test_sql_sessions_req_api_008_end_to_end

  - id: REQ-API-009
    title: Sample data space generation
    description: |
      The API MUST provide a way to generate a sample-data space with a small
      set of input parameters (space id, scenario, entry count, seed), backed
      by ugoite-core dynamic generation.
    related_spec:
      - api/rest.md#spaces
      - features/spaces.yaml
    priority: medium
    status: implemented
    tests:
      pytest:
        - file: backend/tests/test_api.py
          tests:
            - test_create_sample_space
        - file: ugoite-cli/tests/test_space.py
          tests:
            - test_create_sample_space_req_api_009
      vitest:
        - file: frontend/src/lib/client.test.ts
          tests:
            - should create a sample-data space [REQ-API-009]
      rust:
        - file: ugoite-core/tests/test_sample_data.rs
          tests:
            - test_sample_data_req_api_009_create_sample_space
