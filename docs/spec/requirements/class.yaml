# Class Management Requirements

category: Class Management
prefix: REQ-CLS

requirements:
  - id: REQ-CLS-001
    title: List Column Types
    description: |
      CLI and Backend MUST expose available column types for class creation.

      Note: API paths may still use /classes while the user-facing concept is "Class".
    related_spec:
      - api/rest.md#classes
      - data-model/overview.md#classes
    priority: medium
    status: implemented
    tests:
      pytest:
        - file: ieapp-cli/tests/test_classes.py
          tests:
            - test_list_column_types
        - file: ieapp-cli/tests/test_cli_class.py
          tests:
            - test_cli_list_types
        - file: backend/tests/test_api.py
          tests:
            - test_get_class_types
      rust:
        - file: ieapp-core/tests/test_class.rs
          tests:
            - test_class_req_cls_001_list_column_types


  - id: REQ-CLS-002
    title: Class Migration Strategy
    description: |
      When updating a class definition, the system MUST allow specifying
      migration strategies for existing fields (for example: set to null,
      set a default value, or keep as-is).
    related_spec:
      - api/rest.md#classes
      - data-model/overview.md#classes
    priority: medium
    status: implemented
    tests:
      pytest:
        - file: ieapp-cli/tests/test_classes.py
          tests:
            - test_migrate_class_add_column_with_default
            - test_migrate_class_remove_column
        - file: ieapp-cli/tests/test_cli_class.py
          tests:
            - test_cli_class_update
        - file: backend/tests/test_api.py
          tests:
            - test_update_class_with_migration
      rust:
        - file: ieapp-core/tests/test_class.rs
          tests:
            - test_class_req_cls_002_upsert_and_list_classes

  - id: REQ-CLS-003
    title: Class CRUD via API
    description: |
      Backend MUST allow creating, listing, and retrieving class definitions,
      and validate note updates against missing class definitions.
    related_spec:
      - api/rest.md#classes
      - data-model/overview.md#classes
    priority: medium
    status: implemented
    tests:
      pytest:
        - file: backend/tests/test_classes.py
          tests:
            - test_create_and_get_class
            - test_class_validation_in_note
            - test_update_note_with_missing_class_rejected
      e2e:
        - file: e2e/classes.test.ts
          tests:
            - Create and List Classes
            - Query Notes by Class

  - id: REQ-CLS-004
    title: Extra Attributes Policy
    description: |
      Class definitions MUST declare how extra attributes (non-registered H2
      sections) are handled, and the system MUST enforce the policy on note
      creation and update.
    related_spec:
      - data-model/overview.md#classes
      - data-model/file-schemas.yaml#class_definition
    priority: medium
    status: implemented
    tests:
      rust:
        - file: ieapp-core/tests/test_note.rs
          tests:
            - test_note_req_cls_004_deny_extra_attributes
            - test_note_req_cls_004_allow_extra_attributes
