[env]
_.python.venv = { path = ".venv" }
UV_PYTHON = "3.13"
CARGO_TARGET_DIR = "{{env.HOME}}/.cache/ieapp/ieapp-core/target"

[tasks.install]
run = "uv sync"
description = "Install dependencies"

[tasks.build]
run = [
	"rm -f ieapp_core/_ieapp_core.*.so",
	"PYO3_PYTHON=\"$(command -v python)\" uv run maturin develop --release --strip",
]
description = "Build Rust extension for local development"

[tasks.test]
run = [
	"cargo test -j 1",
	"if [ -d tests ]; then uv run pytest; fi",
]
description = "Run Rust crate tests and Python binding tests"
depends = ["build"]

[tasks.lint]
run = "cargo clippy && uv run ruff check ."
description = "Run Rust and Python linters"

[tasks.format]
run = "cargo fmt && uv run ruff format ."
description = "Format Rust and Python code"

[tasks.ty]
run = "uv run ty check ."
description = "Run Python type checking"
