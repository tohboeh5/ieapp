<!DOCTYPE html><html lang="en"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><title>Docs: spec/architecture/overview.md</title><link rel="stylesheet" href="/_astro/_slug_.DCtb3bYL.css"></head> <body> <header class="mx-auto flex max-w-6xl flex-wrap items-center justify-between gap-3 px-4 py-4"> <a href="/" class="text-lg font-semibold">Ugoite Docsite</a> <nav class="flex items-center gap-4 text-sm"> <a href="/docs/guide/cli" class="underline-offset-2 hover:underline">CLI Guide</a> <a href="/docs/spec/api/rest" class="underline-offset-2 hover:underline">REST API</a> <a href="/docs/spec/api/mcp" class="underline-offset-2 hover:underline">MCP API</a> </nav> <div class="flex items-center gap-3"> <label for="theme" class="text-sm text-slate-600">Theme</label> <select id="theme" class="rounded-md border px-2 py-1 text-sm" data-theme-selector> <option value="materialize">Materialize</option><option value="classic">Classic</option><option value="pop">Pop</option> </select> <label for="mode" class="text-sm text-slate-600">Mode</label> <select id="mode" class="rounded-md border px-2 py-1 text-sm" data-mode-selector> <option value="light">Light</option> <option value="dark">Dark</option> </select> </div> <script type="module">const o="ugoite-ui-theme",l="ugoite-color-mode",m=document.documentElement,e=document.querySelector("[data-theme-selector]"),t=document.querySelector("[data-mode-selector]"),a=()=>{const c=e instanceof HTMLSelectElement?e.value:localStorage.getItem(o)||"materialize",n=t instanceof HTMLSelectElement?t.value:localStorage.getItem(l)||"light";m.dataset.uiTheme=c,m.dataset.colorMode=n,localStorage.setItem(o,c),localStorage.setItem(l,n)},i=localStorage.getItem(o)||"materialize",s=localStorage.getItem(l)||"light";e instanceof HTMLSelectElement&&(e.value=i,e.addEventListener("change",()=>{a()}));t instanceof HTMLSelectElement&&(t.value=s,t.addEventListener("change",()=>{a()}));a();</script> </header> <main class="mx-auto max-w-6xl px-4 pb-16">  <article class="prose max-w-none rounded-xl border p-6" style="background: var(--doc-card); border-color: var(--doc-border);"> <p class="mb-4 text-xs" style="color: var(--doc-muted);">Source: /docs/spec/architecture/overview.md</p> <h1>Architecture Overview</h1>
<h2>1. High-Level Architecture</h2>
<p>Ugoite follows a <strong>Local-First, Server-Relay</strong> architecture. The system is designed for:</p>
<ul>
<li><strong>Portability</strong>: Iceberg tables (Parquet) with Markdown reconstruction</li>
<li><strong>AI Integration</strong>: First-class support for AI agents via MCP</li>
<li><strong>Multi-Platform</strong>: Core logic in Rust enables native apps and WebAssembly</li>
</ul>
<pre><code>┌─────────────────────────────┐   ┌─────────────────────────────┐
│            User             │   │           Browser            │
└──────────────┬──────────────┘   └──────────────┬──────────────┘
               │                                 │
     ┌─────────┴─────────┐             ┌─────────┴─────────┐
     │  Frontend App     │             │     Terminal      │
     │  (Web/Desktop)    │             │     (Power User)  │
     └─────────┬─────────┘             └─────────┬─────────┘
               │                                 │
               ▼                                 ▼
┌─────────────────────────────┐   ┌─────────────────────────────┐
│     Backend (FastAPI)       │   │      ugoite-cli (Python)     │
│  - REST API &amp; MCP Server    │   │  - Typer-based CLI          │
│  - Auth &amp; Orchestration     │   │  - Direct data access       │
└──────────────┬──────────────┘   └──────────────┬──────────────┘
               │                                 │
               └────────────────┬────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                   ugoite-core (Rust Crate)                       │
│   - All data operations                                         │
│   - Storage abstraction (OpenDAL)                               │
│   - Compiles to: native, Python binding, WebAssembly            │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                   Storage Layer (OpenDAL)                       │
│   ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐        │
│   │  Local  │   │   S3    │   │  GCS    │   │ Memory  │        │
│   │  Disk   │   │ / MinIO │   │         │   │ (test)  │        │
│   └─────────┘   └─────────┘   └─────────┘   └─────────┘        │
└─────────────────────────────────────────────────────────────────┘
</code></pre>
<h2>2. Module Responsibilities</h2>
<h3>ugoite-core (Rust)</h3>
<p>The core library handles ALL data operations:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Responsibility</th>
</tr>
</thead>
<tbody><tr>
<td><code>space.rs</code></td>
<td>Space CRUD, directory scaffolding</td>
</tr>
<tr>
<td><code>entry.rs</code></td>
<td>Entry CRUD via Iceberg tables, revision history, conflict detection</td>
</tr>
<tr>
<td><code>form.rs</code></td>
<td>Iceberg form schema management</td>
</tr>
<tr>
<td><code>index.rs</code></td>
<td>Structured data extraction, derived indexes</td>
</tr>
<tr>
<td><code>asset.rs</code></td>
<td>Binary file storage, deduplication</td>
</tr>
<tr>
<td><code>link.rs</code></td>
<td>Entry-to-entry relationships</td>
</tr>
<tr>
<td><code>integrity.rs</code></td>
<td>HMAC signing, checksum verification</td>
</tr>
<tr>
<td><code>search.rs</code></td>
<td>Full-text and structured queries</td>
</tr>
</tbody></table>
<h3>ugoite-cli (Python)</h3>
<p>Command-line interface for power users:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Responsibility</th>
</tr>
</thead>
<tbody><tr>
<td><code>cli.py</code></td>
<td>Typer-based CLI</td>
</tr>
<tr>
<td><code>compat.py</code></td>
<td>Backwards compatibility helpers</td>
</tr>
</tbody></table>
<h3>Backend (Python/FastAPI)</h3>
<p>API layer providing access to frontend and AI agents:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Responsibility</th>
</tr>
</thead>
<tbody><tr>
<td><code>api/endpoints/</code></td>
<td>REST route handlers (call ugoite-core bindings)</td>
</tr>
<tr>
<td><code>mcp/</code></td>
<td>MCP protocol implementation</td>
</tr>
<tr>
<td><code>models/</code></td>
<td>Pydantic request/response models</td>
</tr>
<tr>
<td><code>core/</code></td>
<td>Configuration, middleware</td>
</tr>
</tbody></table>
<h3>Frontend (TypeScript/SolidStart)</h3>
<p>UI layer with NO data logic:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Responsibility</th>
</tr>
</thead>
<tbody><tr>
<td><code>lib/*-store.ts</code></td>
<td>State management, optimistic updates</td>
</tr>
<tr>
<td><code>lib/*-api.ts</code></td>
<td>Feature API clients (REST calls only)</td>
</tr>
<tr>
<td><code>routes/</code></td>
<td>Page components</td>
</tr>
<tr>
<td><code>components/</code></td>
<td>Reusable UI components</td>
</tr>
</tbody></table>
<h2>3. The &quot;Structure-from-Text&quot; Engine</h2>
<p>Ugoite bridges the gap between Markdown freedom and database structure:</p>
<ol>
<li><strong>Parse</strong>: Scan Markdown for H2 headers (<code>## Key</code>)</li>
<li><strong>Extract</strong>: Convert headers + content to structured properties</li>
<li><strong>Validate</strong>: Check against Form definition (if assigned)</li>
<li><strong>Index</strong>: Update derived indexes for fast queries</li>
</ol>
<p>This enables &quot;Markdown sections as database fields&quot; without complex forms.</p>
<h2>4. Data Flow Example</h2>
<p><strong>Creating an Entry:</strong></p>
<pre><code>Frontend                 Backend              ugoite-core           Storage
   │                        │                     │                   │
   │ POST /spaces/:id/entries│                    │                   │
   │───────────────────────&gt;│                     │                   │
   │                        │ create_entry()      │                   │
   │                        │────────────────────&gt;│                   │
   │                        │                     │ write Iceberg rows│
   │                        │                     │──────────────────&gt;│
   │                        │                     │ update indexes    │
   │                        │                     │──────────────────&gt;│
   │                        │                     │&lt;──────────────────│
   │                        │&lt;────────────────────│                   │
   │ 201 Created            │                     │                   │
   │&lt;───────────────────────│                     │                   │
   │                        │                     │                   │
   │ (optimistic update     │                     │                   │
   │  already rendered)     │                     │                   │
</code></pre>
<h2>5. Design Principles</h2>
<table>
<thead>
<tr>
<th>Principle</th>
<th>Implementation</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Local-First</strong></td>
<td>All data in user-controlled storage; no required cloud services</td>
</tr>
<tr>
<td><strong>Portable</strong></td>
<td>Iceberg tables (Parquet) + Markdown reconstruction; easy export/import</td>
</tr>
<tr>
<td><strong>AI-Native</strong></td>
<td>MCP protocol + MCP integration for AI agents</td>
</tr>
<tr>
<td><strong>Layered</strong></td>
<td>Clear separation: Core → {CLI, Backend} → Frontend</td>
</tr>
<tr>
<td><strong>Testable</strong></td>
<td>Each layer independently testable; memory storage for fast tests</td>
</tr>
</tbody></table>
 </article>  </main> </body></html>