<!DOCTYPE html><html lang="en"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><title>Docs: spec/data-model/directory-structure.md</title><link rel="stylesheet" href="/_astro/_slug_.DCtb3bYL.css"></head> <body> <header class="mx-auto flex max-w-6xl flex-wrap items-center justify-between gap-3 px-4 py-4"> <a href="/" class="text-lg font-semibold">Ugoite Docsite</a> <nav class="flex items-center gap-4 text-sm"> <a href="/docs/guide/cli" class="underline-offset-2 hover:underline">CLI Guide</a> <a href="/docs/spec/api/rest" class="underline-offset-2 hover:underline">REST API</a> <a href="/docs/spec/api/mcp" class="underline-offset-2 hover:underline">MCP API</a> </nav> <div class="flex items-center gap-3"> <label for="theme" class="text-sm text-slate-600">Theme</label> <select id="theme" class="rounded-md border px-2 py-1 text-sm" data-theme-selector> <option value="materialize">Materialize</option><option value="classic">Classic</option><option value="pop">Pop</option> </select> <label for="mode" class="text-sm text-slate-600">Mode</label> <select id="mode" class="rounded-md border px-2 py-1 text-sm" data-mode-selector> <option value="light">Light</option> <option value="dark">Dark</option> </select> </div> <script type="module">const o="ugoite-ui-theme",l="ugoite-color-mode",m=document.documentElement,e=document.querySelector("[data-theme-selector]"),t=document.querySelector("[data-mode-selector]"),a=()=>{const c=e instanceof HTMLSelectElement?e.value:localStorage.getItem(o)||"materialize",n=t instanceof HTMLSelectElement?t.value:localStorage.getItem(l)||"light";m.dataset.uiTheme=c,m.dataset.colorMode=n,localStorage.setItem(o,c),localStorage.setItem(l,n)},i=localStorage.getItem(o)||"materialize",s=localStorage.getItem(l)||"light";e instanceof HTMLSelectElement&&(e.value=i,e.addEventListener("change",()=>{a()}));t instanceof HTMLSelectElement&&(t.value=s,t.addEventListener("change",()=>{a()}));a();</script> </header> <main class="mx-auto max-w-6xl px-4 pb-16">  <article class="prose max-w-none rounded-xl border p-6" style="background: var(--doc-card); border-color: var(--doc-border);"> <p class="mb-4 text-xs" style="color: var(--doc-muted);">Source: /docs/spec/data-model/directory-structure.md</p> <h1>Directory Structure</h1>
<h2>Space Layout</h2>
<pre><code>hmac.json                             # Root: response-signing key material
spaces/
  {space_id}/                         # Each space is self-contained
    meta.json                         # Space metadata
    settings.json                     # Editor preferences, defaults
    forms/                            # Iceberg-managed root for Form tables
    assets/                           # Binary files (images, audio, etc.)
      {hash}.{ext}                    # Content-addressed storage
    materialized_views/               # SQL materialized view metadata (no rows)
    sql_sessions/                     # SQL query sessions (metadata only)
      {session_id}/                   # Session directory
        meta.json                     # Session metadata (status, snapshots)
</code></pre>
<h2>Root Level</h2>
<h3><code>hmac.json</code></h3>
<p>Root response-signing key material:</p>
<pre><code class="language-json">{
  &quot;hmac_key_id&quot;: &quot;key-2025-11-01&quot;,
  &quot;hmac_key&quot;: &quot;base64-encoded-secret&quot;,
  &quot;last_rotation&quot;: &quot;2025-11-15T00:00:00Z&quot;
}
</code></pre>
<h2>Space Level</h2>
<h3><code>meta.json</code></h3>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;space-main&quot;,
  &quot;name&quot;: &quot;Personal Knowledge&quot;,
  &quot;created_at&quot;: &quot;2025-08-12T12:00:00Z&quot;,
  &quot;storage_config&quot;: {
    &quot;uri&quot;: &quot;s3://my-bucket/ugoite/space-main&quot;,
    &quot;credentials_profile&quot;: &quot;default&quot;
  },
  &quot;merge_strategy&quot;: &quot;manual&quot;,
  &quot;default_form&quot;: &quot;Entry&quot;,
  &quot;encryption&quot;: { &quot;mode&quot;: &quot;none&quot; }
}
</code></pre>
<h3><code>settings.json</code></h3>
<pre><code class="language-json">{
  &quot;default_form&quot;: &quot;Entry&quot;,
  &quot;editor_theme&quot;: &quot;dark&quot;,
  &quot;sync_interval_seconds&quot;: 60
}
</code></pre>
<h2>Form Tables (Iceberg)</h2>
<h3><code>forms/</code></h3>
<p>All form storage is managed by Apache Iceberg using the official Rust crate with
OpenDAL-backed IO. The filesystem layout <strong>beneath this directory</strong> is owned by
Iceberg and is intentionally not specified here. Each Form is represented as an
Iceberg namespace named by the Form name. Each Form namespace contains its own
<code>entries</code> and <code>revisions</code> tables (there is no shared cross-Form table).</p>
<p><strong>Template convention (global):</strong></p>
<pre><code># {form_name}

## {column_1}
## {column_2}
...
</code></pre>
<p>The template is fixed across the service; Form-specific templates are not stored
outside Iceberg.</p>
<p><strong>Required tables (logical names):</strong></p>
<ul>
<li><code>entries</code> (current entry rows)</li>
<li><code>revisions</code> (revision history rows)</li>
</ul>
<p><strong>Required operations:</strong></p>
<ul>
<li>Append new entry rows and update existing entry rows via Iceberg writes.</li>
<li>Append revision rows for every save.</li>
<li>Support snapshot/time-travel reads for conflict resolution and history.</li>
<li>Allow compaction/maintenance via Iceberg without breaking logical access.</li>
</ul>
<h3><code>entries</code> table (logical schema)</h3>
<p>One row per entry. Columns include standard metadata plus <strong>only</strong> the fields
defined by the Iceberg schema for that Form. The Form identity is implied by
the table name.</p>
<p>Example logical schema:</p>
<pre><code class="language-text">entry_id: string
title: string
tags: list&lt;string&gt;
links: list&lt;struct&lt;id: string, target: string, kind: string&gt;&gt;
created_at: timestamp
updated_at: timestamp
fields: struct&lt;...&gt;
</code></pre>
<h3><code>revisions</code> table (logical schema)</h3>
<p>One row per revision. Stores historical snapshots of Form-defined fields so full
Markdown can be reconstructed deterministically.</p>
<p>Example logical schema:</p>
<pre><code class="language-text">revision_id: string
entry_id: string
parent_revision_id: string
timestamp: timestamp
author: string
fields: struct&lt;...&gt;
markdown_checksum: string
</code></pre>
<h2>Portability</h2>
<p>Each space directory is fully portable:</p>
<ul>
<li>Copy to another location to backup</li>
<li>Move to different storage backend</li>
<li>Share with other Ugoite instances</li>
</ul>
<p>Materialized indexes (search, embeddings) are derived from Iceberg tables and can be regenerated.</p>
<h2>SQL Materialized Views (Metadata)</h2>
<h3><code>materialized_views/</code></h3>
<p>Saved SQL entries create a corresponding materialized view <strong>metadata</strong> record
under <code>materialized_views/</code>. The metadata is created on SQL creation, refreshed
on SQL update, and deleted on SQL deletion. The on-disk layout for future
Iceberg-managed views is intentionally not specified.</p>
<h2>SQL Sessions (Metadata Only)</h2>
<p>SQL sessions persist <strong>only metadata</strong> to allow re-running queries against the
current entries tables. Result rows are never stored under <code>sql_sessions/</code>.</p>
 </article>  </main> </body></html>